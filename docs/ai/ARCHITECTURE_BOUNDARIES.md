# Architecture & Boundaries

## Domain Boundaries

### 1. Engine (`packages/engine`)
**Role:** The source of truth for CAD geometry, rendering buffers, and core logic.
- **Allowed Dependencies:** Standard C++ libraries, Emscripten SDK (at build time), Freetype/Harfbuzz (managed deps).
- **Forbidden Dependencies:** JavaScript environment, DOM, React, Python, Node.js.
- **Export Contract:** WASM binary + bindings (Embind).

### 2. Frontend (`apps/web`)
**Role:** Presentation layer, user input handling, and state orchestration.
- **Allowed Dependencies:** React ecosystem, internal `engine/` facades.
- **Forbidden Dependencies:** Direct access to `apps/api` internals (must use HTTP), direct memory access to WASM heap (except via `engine/` wrappers).
- **Engine Interaction:** STRICTLY via `apps/web/engine/**` facades. No component should import `apps/web/public/wasm/engine.js` directly.

### 3. Backend (`apps/api`)
**Role:** Business logic, user authentication, heavy compute (if needed), persistence (future).
- **Allowed Dependencies:** Python ecosystem.
- **Forbidden Dependencies:** Frontend code, Engine C++ source.
- **Interaction:** Exposes REST API.

## Cross-Boundary Rules

### Frontend ↔ Engine
- **Direction:** Frontend calls Engine. Engine sends events to Frontend (via polling/callback).
- **Transport:**
  - **Hot Path (Transform/Hover):** Direct WASM calls via `Runtime` facades. Zero GC allocation allowed.
  - **Cold Path (Load/Save/Commit):** Binary buffers or JSON-serialized commands.

### Frontend ↔ Backend
- **Protocol:** HTTP/REST.
- **Contract:** Defined by OpenAPI (auto-generated by FastAPI).

## Code Organization Rules

1. **No Shared Code via Symlinks**: Code must not be shared between `apps/web` and `apps/api` via symlinks. Use generated contracts (OpenAPI) or shared libraries if absolutely necessary (none currently).
2. **Feature Collocation**: In `apps/web`, features should be grouped by domain (e.g., `features/editor`, `features/settings`), not by technical type.
