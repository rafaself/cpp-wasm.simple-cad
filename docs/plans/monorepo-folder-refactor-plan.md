# Monorepo Folder/File Organization Refactor Plan

**Version:** 1.0
**Date:** 2026-01-15
**Status:** Planning (Awaiting Approval)
**Branch:** `perf/refactor-folder-and-files`

---

## Executive Summary

This document presents a comprehensive plan to reorganize the eletrocad-webapp monorepo folder structure for improved scalability, maintainability, and clarity. The refactor is **strictly limited to folder/file moves and reference updates**—no business logic or runtime behavior changes.

**Key Goals:**
1. Establish a clear, industry-standard monorepo layout
2. Separate apps, packages, infra, tooling, and documentation
3. Eliminate generated artifacts from repository root
4. Ensure build and CI stability throughout migration
5. Prepare for long-term growth (additional apps, packages, domains)

**Risk Level:** Medium (many path references, but all changes are mechanical)
**Estimated Phases:** 4 (incremental migration)

---

## 1. Current State Mapping

### 1.1 Top-Level Directory Inventory

| Directory | Size | Category | Purpose |
|-----------|------|----------|---------|
| `frontend/` | ~510 MB | **APP** | React/TypeScript web application |
| `cpp/` | ~214 MB | **PACKAGE** | C++ WASM engine source + build artifacts |
| `backend/` | ~52 KB | **APP** | FastAPI Python backend service |
| `docs/` | ~300 KB | **DOCS** | Project documentation & plans |
| `scripts/` | ~80 KB | **TOOLING** | Governance, linting, build scripts |
| `resources/` | ~20 KB | **DOCS** | Prompts, requisites specifications |
| `docker/` | ~12 KB | **INFRA** | Dockerfile configurations |
| `Testing/` | ~12 KB | **ARTIFACT** | CMake test temporary output (should not exist at root) |
| `.github/` | ~4 KB | **META** | GitHub workflows & PR templates |
| `.agent/` | ~4 KB | **META** | AI agent rules & workflows |
| `.claude/` | ~4 KB | **META** | Claude IDE local settings |

### 1.2 Root-Level Configuration Files

| File | Category | Purpose | Migration Impact |
|------|----------|---------|------------------|
| `Makefile` | CONFIG | Build orchestration | **HIGH** - Contains path variables |
| `docker-compose.yml` | INFRA | WASM builder service | **HIGH** - Contains volume mounts |
| `.gitignore` | CONFIG | VCS exclusions | **MEDIUM** - Path patterns |
| `.dockerignore` | CONFIG | Docker build exclusions | **LOW** |
| `.env` | CONFIG | Environment variables (empty) | **NONE** |
| `AGENTS.md` | DOCS | AI agent guidelines (446 lines) | **MEDIUM** - Path references |
| `README.md` | DOCS | Project overview | **LOW** |
| `LICENSES.md` | DOCS | License information | **NONE** |

### 1.3 Current Issues Identified

| Issue | Location | Impact |
|-------|----------|--------|
| **Build artifacts at root** | `Testing/` | Pollutes root, tracked by git risk |
| **Inconsistent naming** | `Testing/` vs `tests/` | Confusing convention |
| **Multiple AGENTS.md copies** | Root, `.agent/`, `resources/` | Potential drift |
| **Mixed concerns in `scripts/`** | Governance + build scripts | Should be separated |
| **No clear `infra/` boundary** | `docker/` isolated, CI in `.github/` | Split infrastructure |
| **Docs scattered** | `docs/`, `resources/`, root `*.md` | Consolidation needed |
| **No `packages/` convention** | `cpp/` at root | Non-standard for monorepo |

### 1.4 Build Output Directories (Must Be Excluded)

| Path | Generated By | .gitignore Status |
|------|--------------|-------------------|
| `frontend/dist/` | Vite build | Ignored (`dist/`) |
| `frontend/dist/wasm/` | Docker/Emscripten | Ignored |
| `frontend/coverage/` | Vitest | Not explicitly ignored |
| `frontend/node_modules/` | pnpm | Ignored |
| `cpp/build/` | CMake (Release) | Ignored |
| `cpp/build_native/` | CMake (Native) | Ignored |
| `cpp/build_test/` | CMake (Debug) | Not explicitly ignored |
| `cpp_build_test/` | Makefile target | Not explicitly ignored |
| `Testing/` | CMake (root) | **NOT IGNORED** |
| `reports/` | Deadcode scripts | **NOT IGNORED** |

---

## 2. Target Information Architecture

### 2.1 Primary Layout (Recommended)

```
eletrocad-webapp/
├── apps/                           # Deployable applications
│   ├── web/                        # React frontend (renamed from frontend/)
│   │   ├── src/
│   │   ├── features/
│   │   ├── engine/
│   │   ├── components/
│   │   ├── stores/
│   │   ├── tests/
│   │   ├── public/
│   │   │   └── wasm/               # WASM artifacts land here
│   │   ├── package.json
│   │   ├── vite.config.ts
│   │   └── ...
│   └── api/                        # Python backend (renamed from backend/)
│       ├── app/
│       └── requirements.txt
│
├── packages/                       # Shared packages/engines
│   └── engine/                     # C++ WASM engine (renamed from cpp/)
│       ├── engine/                 # Source code
│       ├── tests/
│       ├── CMakeLists.txt
│       └── engine.cpp
│
├── infra/                          # Infrastructure configurations
│   ├── docker/                     # Dockerfiles (moved from docker/)
│   │   ├── Dockerfile.frontend
│   │   └── Dockerfile.backend
│   └── ci/                         # CI workflow templates (optional)
│
├── tooling/                        # Build & governance tooling
│   ├── governance/                 # Code governance scripts
│   │   ├── check_file_size_budget.js
│   │   ├── check_boundaries.js
│   │   ├── check_engine_api_manifest.js
│   │   ├── check_docs_references.js
│   │   ├── deadcode_ts_report.js
│   │   ├── deadcode_cpp_report.sh
│   │   ├── boundary_rules.json
│   │   ├── file_size_budget.json
│   │   └── file_size_budget_exceptions.json
│   └── scripts/                    # Build/utility scripts
│       ├── check-file-size.sh
│       ├── lint-styles.sh
│       └── loc-report.sh
│
├── docs/                           # Documentation (consolidated)
│   ├── architecture/               # Architecture docs (from agents/)
│   │   ├── engine-api.md
│   │   ├── frontend-patterns.md
│   │   ├── text-system.md
│   │   ├── workflows.md
│   │   └── handle-index-contract.md
│   ├── governance/                 # Governance policies
│   │   ├── ENGINE_FIRST_GOVERNANCE.md
│   │   ├── DEAD_CODE_REMOVAL_PROCESS.md
│   │   └── AGENT_RUNBOOK.md
│   ├── plans/                      # Implementation plans
│   ├── reports/                    # Investigation reports
│   ├── specs/                      # Requirements (from resources/)
│   │   └── text.md
│   └── api/                        # API documentation
│       ├── ENGINE_API_MANIFEST.md
│       └── engine_api_manifest.json
│
├── .github/                        # GitHub-specific (unchanged)
│   ├── workflows/
│   │   └── ci.yml
│   └── pull_request_template.md
│
├── .agent/                         # AI agent config (unchanged)
├── .claude/                        # Claude IDE config (unchanged)
│
├── docker-compose.yml              # Root compose (updated paths)
├── Makefile                        # Root Makefile (updated paths)
├── .gitignore                      # Updated patterns
├── .dockerignore
├── README.md
├── AGENTS.md                       # Single source of truth
└── LICENSES.md
```

### 2.2 Alternative Layout (Flatter Structure)

If the team prefers a flatter hierarchy:

```
eletrocad-webapp/
├── frontend/                       # Keep original name
├── backend/
├── engine/                         # Rename cpp/ to engine/
├── docker/
├── scripts/                        # Keep combined
├── docs/
├── .github/
├── Makefile
└── docker-compose.yml
```

**Recommendation:** Primary layout is preferred for scalability.

### 2.3 Naming Conventions

| Aspect | Convention | Examples |
|--------|------------|----------|
| **Directories** | lowercase, kebab-case for multi-word | `apps/`, `web/`, `file-size-budget/` |
| **Files** | camelCase for JS/TS, snake_case for scripts | `vite.config.ts`, `check_boundaries.js` |
| **Config files** | lowercase with dots | `.gitignore`, `docker-compose.yml` |
| **Documentation** | UPPERCASE for governance, lowercase for technical | `AGENTS.md`, `engine-api.md` |

### 2.4 Generated Files Strategy

| Artifact Type | Location | .gitignore Pattern |
|---------------|----------|-------------------|
| Node modules | `apps/web/node_modules/` | `node_modules/` |
| Frontend build | `apps/web/dist/` | `**/dist/` |
| Test coverage | `apps/web/coverage/` | `**/coverage/` |
| WASM output | `apps/web/public/wasm/` | `apps/web/public/wasm/*.wasm` |
| CMake build | `packages/engine/build*/` | `**/build*/` |
| Python venv | `apps/api/.venv/` | `.venv/` |
| Deadcode reports | `reports/` (gitignored) | `reports/` |
| CMake Testing | (none - controlled by build dir) | `Testing/` |

---

## 3. Impact Analysis

### 3.1 Files Requiring Path Updates

#### 3.1.1 Makefile (Critical)

**Current paths:**
```makefile
FRONTEND_DIR := frontend
CPP_DIR := cpp
CPP_BUILD_DIR := cpp_build_test
PNPM := pnpm --dir $(FRONTEND_DIR)
```

**Required changes:**
```makefile
FRONTEND_DIR := apps/web
CPP_DIR := packages/engine
CPP_BUILD_DIR := packages/engine/build_test
PNPM := pnpm --dir $(FRONTEND_DIR)
```

**Additional updates:**
- `test-view` target: `cd $(FRONTEND_DIR)`
- `ctest` target: `cmake ../$(CPP_DIR)`

#### 3.1.2 docker-compose.yml (Critical)

**Current volumes:**
```yaml
volumes:
  - ./cpp:/workspace/cpp
  - ./frontend/public/wasm:/workspace/output
```

**Required changes:**
```yaml
volumes:
  - ./packages/engine:/workspace/cpp
  - ./apps/web/public/wasm:/workspace/output
```

#### 3.1.3 CMakeLists.txt (Critical)

**Current output path:**
```cmake
set(DEFAULT_OUTPUT_DIR "${PROJECT_SOURCE_DIR}/../frontend/public/wasm")
```

**Required changes:**
```cmake
set(DEFAULT_OUTPUT_DIR "${PROJECT_SOURCE_DIR}/../../apps/web/public/wasm")
```

#### 3.1.4 CI Workflow (.github/workflows/ci.yml) (Critical)

**Current paths:**
```yaml
working-directory: frontend
cache-dependency-path: frontend/pnpm-lock.yaml
cmake -S cpp -B cpp/build_native
```

**Required changes:**
```yaml
working-directory: apps/web
cache-dependency-path: apps/web/pnpm-lock.yaml
cmake -S packages/engine -B packages/engine/build_native
```

**Governance script paths:**
```yaml
run: ./scripts/check-file-size.sh
run: node scripts/deadcode_ts_report.js
run: node scripts/check_docs_references.js
run: bash scripts/deadcode_cpp_report.sh
```

**Change to:**
```yaml
run: ./tooling/scripts/check-file-size.sh
run: node tooling/governance/deadcode_ts_report.js
run: node tooling/governance/check_docs_references.js
run: bash tooling/governance/deadcode_cpp_report.sh
```

#### 3.1.5 Frontend package.json Scripts

**Current:**
```json
"build:wasm": "docker compose -f ../docker-compose.yml run --rm wasm-builder",
"governance:budgets": "node ../scripts/check_file_size_budget.js",
"governance:boundaries": "node ../scripts/check_boundaries.js",
"governance:manifest": "node ../scripts/check_engine_api_manifest.js",
"governance:docs": "node ../scripts/check_docs_references.js"
```

**Required changes:**
```json
"build:wasm": "docker compose -f ../../docker-compose.yml run --rm wasm-builder",
"governance:budgets": "node ../../tooling/governance/check_file_size_budget.js",
"governance:boundaries": "node ../../tooling/governance/check_boundaries.js",
"governance:manifest": "node ../../tooling/governance/check_engine_api_manifest.js",
"governance:docs": "node ../../tooling/governance/check_docs_references.js"
```

#### 3.1.6 Governance Scripts Internal Paths

**scripts/boundary_rules.json:**
```json
"path": "frontend/engine/core/EngineRuntime"
→
"path": "apps/web/engine/core/EngineRuntime"
```

**scripts/file_size_budget_exceptions.json:**
```json
"path": "cpp/engine/engine.h"
→
"path": "packages/engine/engine/engine.h"

"path": "frontend/components/TextInputProxy.tsx"
→
"path": "apps/web/components/TextInputProxy.tsx"
```

**scripts/check_docs_references.js:**
```javascript
const targets = [
  path.join(repoRoot, 'AGENTS.md'),
  path.join(repoRoot, 'docs', 'ENGINE_FIRST_GOVERNANCE.md'),
];
```
→
```javascript
const targets = [
  path.join(repoRoot, 'AGENTS.md'),
  path.join(repoRoot, 'docs', 'governance', 'ENGINE_FIRST_GOVERNANCE.md'),
];
```

### 3.2 Breakage Risk Matrix

| Component | Risk Level | Mitigation |
|-----------|------------|------------|
| **Makefile targets** | HIGH | Test all targets after path updates |
| **docker-compose volumes** | HIGH | Test WASM build immediately |
| **CMake output directory** | HIGH | Verify WASM lands in correct public path |
| **CI workflows** | HIGH | Run full CI after each phase |
| **Governance scripts** | MEDIUM | Update internal path references |
| **package.json scripts** | MEDIUM | Test all npm scripts |
| **AGENTS.md doc links** | LOW | Run doc reference checker |
| **Import paths in TS** | NONE | No source moves within apps/web |
| **C++ includes** | NONE | No source moves within packages/engine |

### 3.3 Files That Will NOT Change

- All TypeScript/TSX source files (only the container folder moves)
- All C++ source files (only the container folder moves)
- `vite.config.ts` (uses relative `@` alias)
- `tsconfig.json` (paths are relative)
- Python source files
- `.eslintrc.cjs`, `prettier.config.cjs`, etc. (local to frontend)

---

## 4. Phased Migration Plan

### Phase 0: Pre-Flight Preparation

**Goals:**
- Ensure clean git state
- Update .gitignore for future structure
- Remove any tracked build artifacts
- Establish CI baseline

**Tasks:**
```bash
# 1. Verify clean working tree
git status

# 2. Remove tracked artifacts (if any)
rm -rf Testing/
git rm -rf Testing/ 2>/dev/null || true

# 3. Update .gitignore (add new patterns)
# Add:
#   **/build*/
#   **/coverage/
#   reports/
#   Testing/
#   cpp_build_test/

# 4. Commit pre-flight cleanup
git add .gitignore
git commit -m "chore: update gitignore for folder refactor pre-flight"

# 5. Run baseline CI checks
make checks
```

**Validation Checklist:**
- [ ] `git status` shows clean working tree
- [ ] No `Testing/` directory at root
- [ ] `.gitignore` updated
- [ ] `make checks` passes
- [ ] CI pipeline passes on this commit

**Rollback:** `git revert HEAD`

---

### Phase 1: Create Target Structure (No Moves)

**Goals:**
- Create new directory skeleton
- No file moves yet
- Verify structure is correct

**Tasks:**
```bash
# 1. Create apps/ structure
mkdir -p apps

# 2. Create packages/ structure
mkdir -p packages

# 3. Create infra/ structure
mkdir -p infra

# 4. Create tooling/ structure
mkdir -p tooling/governance
mkdir -p tooling/scripts

# 5. Create docs/ substructure
mkdir -p docs/architecture
mkdir -p docs/governance
mkdir -p docs/specs
mkdir -p docs/api

# 6. Commit skeleton
git add .
git commit -m "chore: create target folder structure skeleton"
```

**Validation Checklist:**
- [ ] Directory structure exists as planned
- [ ] No files moved yet
- [ ] Build still works (`make all`)

**Rollback:** `git revert HEAD`

---

### Phase 2: Migrate Core Components

This phase is split into sub-phases to minimize risk.

#### Phase 2a: Move Frontend → apps/web

**Tasks:**
```bash
# 1. Move frontend to apps/web
git mv frontend apps/web

# 2. Update Makefile
# FRONTEND_DIR := frontend → FRONTEND_DIR := apps/web

# 3. Update docker-compose.yml
# ./frontend/public/wasm → ./apps/web/public/wasm

# 4. Update CI workflow
# working-directory: frontend → working-directory: apps/web
# frontend/pnpm-lock.yaml → apps/web/pnpm-lock.yaml

# 5. Commit
git add .
git commit -m "refactor: move frontend to apps/web"
```

**Validation:**
```bash
make install
make dev  # Verify dev server starts
make test
make build
```

**Validation Checklist:**
- [ ] `make install` succeeds
- [ ] `make dev` starts dev server
- [ ] `make test` passes
- [ ] `make build` succeeds
- [ ] CI workflow passes

**Rollback:** `git revert HEAD`

#### Phase 2b: Move C++ Engine → packages/engine

**Tasks:**
```bash
# 1. Move cpp to packages/engine
git mv cpp packages/engine

# 2. Update Makefile
# CPP_DIR := cpp → CPP_DIR := packages/engine
# CPP_BUILD_DIR := cpp_build_test → CPP_BUILD_DIR := packages/engine/build_test

# 3. Update docker-compose.yml
# ./cpp:/workspace/cpp → ./packages/engine:/workspace/cpp

# 4. Update CMakeLists.txt (output path)
# ../frontend/public/wasm → ../../apps/web/public/wasm

# 5. Update CI workflow
# cmake -S cpp → cmake -S packages/engine
# cpp/build_native → packages/engine/build_native

# 6. Update .gitignore
# cpp/build/ → packages/engine/build/

# 7. Commit
git add .
git commit -m "refactor: move cpp to packages/engine"
```

**Validation:**
```bash
make ctest
make wasm  # Critical: verify WASM builds and lands in correct path
ls apps/web/public/wasm/  # Should contain engine.js, engine.wasm
make build
```

**Validation Checklist:**
- [ ] `make ctest` passes
- [ ] `make wasm` succeeds
- [ ] WASM files appear in `apps/web/public/wasm/`
- [ ] `make build` succeeds
- [ ] CI workflow passes

**Rollback:** `git revert HEAD`

#### Phase 2c: Move Backend → apps/api

**Tasks:**
```bash
# 1. Move backend to apps/api
git mv backend apps/api

# 2. Update docker-compose.yml (commented sections)
# ./backend → ./apps/api

# 3. Commit
git add .
git commit -m "refactor: move backend to apps/api"
```

**Validation:**
- Backend is minimal and not actively used in CI
- Verify structure is correct

**Validation Checklist:**
- [ ] `apps/api/` contains expected files
- [ ] No broken references (backend not in active CI)

**Rollback:** `git revert HEAD`

---

### Phase 3: Migrate Infrastructure & Tooling

#### Phase 3a: Move Docker → infra/docker

**Tasks:**
```bash
# 1. Move docker to infra/docker
git mv docker infra/docker

# 2. Update docker-compose.yml (if Dockerfiles are referenced)
# Note: Current compose only uses emscripten/emsdk image, no local Dockerfiles

# 3. Commit
git add .
git commit -m "refactor: move docker to infra/docker"
```

**Validation Checklist:**
- [ ] `infra/docker/` contains Dockerfiles
- [ ] No broken references

**Rollback:** `git revert HEAD`

#### Phase 3b: Move Scripts → tooling/

**Tasks:**
```bash
# 1. Move governance scripts
git mv scripts/check_file_size_budget.js tooling/governance/
git mv scripts/check_boundaries.js tooling/governance/
git mv scripts/check_engine_api_manifest.js tooling/governance/
git mv scripts/generate_engine_api_manifest.js tooling/governance/
git mv scripts/check_docs_references.js tooling/governance/
git mv scripts/deadcode_ts_report.js tooling/governance/
git mv scripts/deadcode_cpp_report.sh tooling/governance/
git mv scripts/boundary_rules.json tooling/governance/
git mv scripts/file_size_budget.json tooling/governance/
git mv scripts/file_size_budget_exceptions.json tooling/governance/

# 2. Move utility scripts
git mv scripts/check-file-size.sh tooling/scripts/
git mv scripts/lint-styles.sh tooling/scripts/
git mv scripts/loc-report.sh tooling/scripts/

# 3. Remove empty scripts directory
rmdir scripts

# 4. Update CI workflow paths
# ./scripts/ → ./tooling/scripts/ or ./tooling/governance/

# 5. Update apps/web/package.json paths
# ../scripts/ → ../../tooling/governance/

# 6. Update internal paths in governance scripts
# See section 3.1.6 for details

# 7. Commit
git add .
git commit -m "refactor: move scripts to tooling/"
```

**Validation:**
```bash
cd apps/web
pnpm governance:check
```

**Validation Checklist:**
- [ ] `pnpm governance:check` passes
- [ ] CI workflow passes
- [ ] All governance scripts work

**Rollback:** `git revert HEAD`

#### Phase 3c: Consolidate Documentation

**Tasks:**
```bash
# 1. Move agents docs to architecture
git mv docs/agents/engine-api.md docs/architecture/
git mv docs/agents/frontend-patterns.md docs/architecture/
git mv docs/agents/text-system.md docs/architecture/
git mv docs/agents/workflows.md docs/architecture/
git mv docs/agents/handle-index-contract.md docs/architecture/
git mv docs/agents/audit-action-plan.md docs/architecture/
rmdir docs/agents

# 2. Move governance docs
git mv docs/ENGINE_FIRST_GOVERNANCE.md docs/governance/
git mv docs/DEAD_CODE_REMOVAL_PROCESS.md docs/governance/
git mv docs/AGENT_RUNBOOK.md docs/governance/
git mv docs/COMMAND_INPUT_IMPLEMENTATION_PLAN.md docs/plans/

# 3. Move API docs
git mv docs/ENGINE_API_MANIFEST.md docs/api/
git mv docs/engine_api_manifest.json docs/api/

# 4. Move specs from resources
git mv resources/requisites/text.md docs/specs/
rmdir resources/requisites
rmdir resources/prompts  # If empty or duplicate
rmdir resources

# 5. Update AGENTS.md doc references
# docs/agents/engine-api.md → docs/architecture/engine-api.md
# docs/ENGINE_FIRST_GOVERNANCE.md → docs/governance/ENGINE_FIRST_GOVERNANCE.md

# 6. Update check_docs_references.js targets
# path.join(repoRoot, 'docs', 'ENGINE_FIRST_GOVERNANCE.md')
# → path.join(repoRoot, 'docs', 'governance', 'ENGINE_FIRST_GOVERNANCE.md')

# 7. Commit
git add .
git commit -m "refactor: consolidate documentation structure"
```

**Validation:**
```bash
node tooling/governance/check_docs_references.js
```

**Validation Checklist:**
- [ ] Doc reference checker passes
- [ ] All doc links in AGENTS.md are valid
- [ ] No duplicate documentation

**Rollback:** `git revert HEAD`

---

### Phase 4: Cleanup & Governance

#### Phase 4a: Remove Duplicate AGENTS.md

**Tasks:**
```bash
# 1. Verify root AGENTS.md is the source of truth
# 2. Remove duplicates if they exist
rm -f .agent/rules/AGENTS.md  # If it's a duplicate
rm -f resources/prompts/AGENTS.md  # If it exists

# 3. Commit
git add .
git commit -m "chore: remove duplicate AGENTS.md files"
```

#### Phase 4b: Final .gitignore Updates

**Tasks:**
```bash
# Ensure .gitignore has all necessary patterns
# See section 2.4 for complete list

git add .gitignore
git commit -m "chore: finalize gitignore patterns"
```

#### Phase 4c: Update README.md

**Tasks:**
- Update project structure section
- Update build instructions with new paths
- Commit

---

## 5. Complete Move Map

### 5.1 Directory Moves

| Source | Destination | Phase |
|--------|-------------|-------|
| `frontend/` | `apps/web/` | 2a |
| `cpp/` | `packages/engine/` | 2b |
| `backend/` | `apps/api/` | 2c |
| `docker/` | `infra/docker/` | 3a |
| `scripts/` | `tooling/governance/` + `tooling/scripts/` | 3b |
| `docs/agents/` | `docs/architecture/` | 3c |
| `resources/requisites/` | `docs/specs/` | 3c |

### 5.2 Configuration Update Map

| File | Updates Required | Phase |
|------|------------------|-------|
| `Makefile` | `FRONTEND_DIR`, `CPP_DIR`, `CPP_BUILD_DIR` | 2a, 2b |
| `docker-compose.yml` | Volume mount paths | 2a, 2b |
| `packages/engine/CMakeLists.txt` | `DEFAULT_OUTPUT_DIR` | 2b |
| `.github/workflows/ci.yml` | All path references | 2a, 2b, 3b |
| `apps/web/package.json` | Script paths to governance | 3b |
| `tooling/governance/boundary_rules.json` | All `frontend/` paths | 3b |
| `tooling/governance/file_size_budget_exceptions.json` | All paths | 3b |
| `tooling/governance/check_docs_references.js` | Target paths | 3c |
| `AGENTS.md` | Doc reference paths | 3c |
| `.gitignore` | Path patterns | 0, 4b |

---

## 6. Acceptance Criteria

### 6.1 Build Verification

| Check | Command | Expected Result |
|-------|---------|-----------------|
| Install dependencies | `make install` | Exit 0 |
| Build WASM | `make wasm` | Exit 0, files in `apps/web/public/wasm/` |
| Build frontend | `make build` | Exit 0, `apps/web/dist/` created |
| Run tests | `make test` | All tests pass |
| Run C++ tests | `make ctest` | All tests pass |
| Dev server | `make dev` | Server starts on port 3000 |
| Governance | `cd apps/web && pnpm governance:check` | Exit 0 |

### 6.2 CI Verification

| Job | Expected Status |
|-----|-----------------|
| `size-check` | Pass |
| `frontend` | Pass |
| `cpp` | Pass |
| `governance-deadcode-check` | Pass |

### 6.3 Artifact Verification

- [ ] `apps/web/public/wasm/engine.js` exists after `make wasm`
- [ ] `apps/web/public/wasm/engine.wasm` exists after `make wasm`
- [ ] No tracked generated files (`git status` clean after build)
- [ ] `reports/` directory is gitignored

### 6.4 Documentation Verification

- [ ] `node tooling/governance/check_docs_references.js` passes
- [ ] All links in AGENTS.md resolve to existing files
- [ ] No duplicate AGENTS.md files

---

## 7. Risks and Mitigations

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| **WASM build path breaks** | Medium | High | Test immediately after Phase 2b |
| **CI job failures** | Medium | Medium | Run CI after each phase commit |
| **Governance script path errors** | Medium | Low | Run all governance checks after Phase 3b |
| **Doc link rot** | Low | Low | Doc checker validates |
| **Merge conflicts on main** | Low | Medium | Complete migration in single PR |
| **Developer workflow disruption** | Low | Low | Document new paths in README |

---

## 8. Long-Term Governance Recommendations

### 8.1 Path Linting (Optional Future Enhancement)

Consider adding a custom ESLint rule or CI check that:
- Validates import paths match expected patterns
- Prevents imports across architectural boundaries
- Enforces `apps/*/` and `packages/*/` conventions

### 8.2 Monorepo Tooling (Optional)

If the repo grows significantly, consider:
- **pnpm workspaces** for multi-package management
- **Turborepo** or **Nx** for build caching and dependency graph
- **Changesets** for versioning packages

### 8.3 Documentation Automation

- Auto-generate structure docs from filesystem
- Link validation in pre-commit hooks
- Architecture diagram generation

---

## 9. Summary

This refactor plan provides a clear, phased approach to reorganizing the monorepo into a scalable, industry-standard layout. The key principles are:

1. **Incremental migration** - Each phase is independently committable and revertible
2. **Immediate validation** - Every phase has explicit validation steps
3. **Minimal risk** - No business logic changes, only path updates
4. **Future-proof** - Structure supports additional apps and packages

**Recommended execution:** Complete all phases in a single feature branch, then merge to main as one PR after full CI validation.

---

## Appendix A: Final Target Structure (Tree View)

```
eletrocad-webapp/
├── apps/
│   ├── web/                        # React frontend
│   │   ├── assets/
│   │   ├── components/
│   │   ├── config/
│   │   ├── coverage/               # (gitignored)
│   │   ├── design/
│   │   ├── dist/                   # (gitignored)
│   │   ├── engine/
│   │   ├── features/
│   │   ├── hooks/
│   │   ├── i18n/
│   │   ├── node_modules/           # (gitignored)
│   │   ├── persistence/
│   │   ├── public/
│   │   │   └── wasm/
│   │   │       ├── engine.js
│   │   │       └── engine.wasm     # (gitignored)
│   │   ├── scripts/
│   │   ├── shared/
│   │   ├── src/
│   │   ├── stores/
│   │   ├── test-utils/
│   │   ├── tests/
│   │   ├── utils/
│   │   ├── verification/
│   │   ├── .env
│   │   ├── .eslintrc.cjs
│   │   ├── App.tsx
│   │   ├── index.html
│   │   ├── index.tsx
│   │   ├── package.json
│   │   ├── pnpm-lock.yaml
│   │   ├── postcss.config.cjs
│   │   ├── prettier.config.cjs
│   │   ├── tailwind.config.cjs
│   │   ├── tsconfig.json
│   │   ├── vite.config.ts
│   │   └── vitest.config.ts
│   └── api/                        # Python backend
│       ├── app/
│       └── requirements.txt
├── packages/
│   └── engine/                     # C++ WASM engine
│       ├── build/                  # (gitignored)
│       ├── engine/
│       ├── msdfgen_config/
│       ├── tests/
│       ├── CMakeLists.txt
│       └── engine.cpp
├── infra/
│   └── docker/
│       ├── Dockerfile.backend
│       └── Dockerfile.frontend
├── tooling/
│   ├── governance/
│   │   ├── boundary_rules.json
│   │   ├── check_boundaries.js
│   │   ├── check_docs_references.js
│   │   ├── check_engine_api_manifest.js
│   │   ├── check_file_size_budget.js
│   │   ├── deadcode_cpp_report.sh
│   │   ├── deadcode_ts_report.js
│   │   ├── file_size_budget.json
│   │   ├── file_size_budget_exceptions.json
│   │   └── generate_engine_api_manifest.js
│   └── scripts/
│       ├── check-file-size.sh
│       ├── lint-styles.sh
│       └── loc-report.sh
├── docs/
│   ├── api/
│   │   ├── ENGINE_API_MANIFEST.md
│   │   └── engine_api_manifest.json
│   ├── architecture/
│   │   ├── audit-action-plan.md
│   │   ├── engine-api.md
│   │   ├── frontend-patterns.md
│   │   ├── handle-index-contract.md
│   │   ├── text-system.md
│   │   └── workflows.md
│   ├── governance/
│   │   ├── AGENT_RUNBOOK.md
│   │   ├── DEAD_CODE_REMOVAL_PROCESS.md
│   │   └── ENGINE_FIRST_GOVERNANCE.md
│   ├── plans/
│   │   ├── COMMAND_INPUT_IMPLEMENTATION_PLAN.md
│   │   ├── desenho-inspector-transform-properties.md
│   │   ├── figma-rotation-implementation.md
│   │   └── monorepo-folder-refactor-plan.md
│   ├── reports/
│   │   ├── colors-ux-engine-first.md
│   │   ├── shape-creation-regression-fix-plan.md
│   │   └── shape-creation-regression-investigation.md
│   └── specs/
│       └── text.md
├── .agent/
│   ├── rules/
│   └── workflows/
├── .claude/
├── .github/
│   ├── pull_request_template.md
│   └── workflows/
│       └── ci.yml
├── .dockerignore
├── .env
├── .gitignore
├── AGENTS.md
├── docker-compose.yml
├── LICENSES.md
├── Makefile
└── README.md
```

---

## Appendix B: Git Commands Summary

```bash
# Phase 0
rm -rf Testing/
git add .gitignore
git commit -m "chore: update gitignore for folder refactor pre-flight"

# Phase 1
mkdir -p apps packages infra tooling/governance tooling/scripts
mkdir -p docs/architecture docs/governance docs/specs docs/api
git add .
git commit -m "chore: create target folder structure skeleton"

# Phase 2a
git mv frontend apps/web
# Update Makefile, docker-compose.yml, ci.yml
git add .
git commit -m "refactor: move frontend to apps/web"

# Phase 2b
git mv cpp packages/engine
# Update Makefile, docker-compose.yml, CMakeLists.txt, ci.yml, .gitignore
git add .
git commit -m "refactor: move cpp to packages/engine"

# Phase 2c
git mv backend apps/api
git add .
git commit -m "refactor: move backend to apps/api"

# Phase 3a
git mv docker infra/docker
git add .
git commit -m "refactor: move docker to infra/docker"

# Phase 3b
git mv scripts/check_file_size_budget.js tooling/governance/
git mv scripts/check_boundaries.js tooling/governance/
# ... (all governance scripts)
git mv scripts/check-file-size.sh tooling/scripts/
git mv scripts/lint-styles.sh tooling/scripts/
git mv scripts/loc-report.sh tooling/scripts/
rmdir scripts
# Update ci.yml, package.json, internal script paths
git add .
git commit -m "refactor: move scripts to tooling/"

# Phase 3c
git mv docs/agents/* docs/architecture/
rmdir docs/agents
git mv docs/ENGINE_FIRST_GOVERNANCE.md docs/governance/
git mv docs/DEAD_CODE_REMOVAL_PROCESS.md docs/governance/
git mv docs/AGENT_RUNBOOK.md docs/governance/
git mv docs/COMMAND_INPUT_IMPLEMENTATION_PLAN.md docs/plans/
git mv docs/ENGINE_API_MANIFEST.md docs/api/
git mv docs/engine_api_manifest.json docs/api/
git mv resources/requisites/text.md docs/specs/
rm -rf resources
# Update AGENTS.md, check_docs_references.js
git add .
git commit -m "refactor: consolidate documentation structure"

# Phase 4
# Cleanup duplicates, finalize gitignore, update README
git add .
git commit -m "chore: finalize folder refactor cleanup"
```

---

**End of Document**
