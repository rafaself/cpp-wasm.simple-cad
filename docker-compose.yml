# Dev compose for the WASM build helper only.
# Frontend/backend services are intentionally commented out; run them locally.
services:
  # frontend:
  #   build:
  #     context: .
  #     dockerfile: infra/docker/Dockerfile.frontend
  #   working_dir: /workspace/frontend
  #   command: bash -lc "pnpm install && pnpm dev -- --host 0.0.0.0 --port 3000"
  #   ports:
  #     - "3000:3000"
  #   environment:
  #     - NODE_ENV=development
  #     - CHOKIDAR_USEPOLLING=1
  #   volumes:
  #     - ./apps/web:/workspace/frontend
  #     - frontend_node_modules:/workspace/frontend/node_modules
  #   depends_on:
  #     - backend

  # backend:
  #   build:
  #     context: .
  #     dockerfile: infra/docker/Dockerfile.backend
  #   working_dir: /workspace/backend
  #   command: bash -lc "python -m venv /workspace/backend/.venv || true && . /workspace/backend/.venv/bin/activate && pip install -r requirements.txt && uvicorn app.main:app --reload --host 0.0.0.0 --port 8000"
  #   ports:
  #     - "8000:8000"
  #   environment:
  #     - PYTHONUNBUFFERED=1
  #   volumes:
  #     - ./apps/api:/workspace/backend
  #     - backend_venv:/workspace/backend/.venv

  wasm-builder:
    image: emscripten/emsdk:3.1.51
    working_dir: /workspace/cpp
    volumes:
      - ./packages/engine:/workspace/cpp
      - ./apps/web/public/wasm:/workspace/output
    command:
      - bash
      - -lc
      - >-
        emcmake cmake -S . -B build
        -DCMAKE_BUILD_TYPE=Release
        -DOUTPUT_DIR=/workspace/output
        && cmake --build build -j

# volumes:
#   frontend_node_modules:
#   backend_venv:
